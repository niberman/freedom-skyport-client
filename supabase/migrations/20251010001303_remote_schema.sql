revoke delete on table "public"."activity_logs" from "anon";

revoke insert on table "public"."activity_logs" from "anon";

revoke references on table "public"."activity_logs" from "anon";

revoke select on table "public"."activity_logs" from "anon";

revoke trigger on table "public"."activity_logs" from "anon";

revoke truncate on table "public"."activity_logs" from "anon";

revoke update on table "public"."activity_logs" from "anon";

revoke delete on table "public"."activity_logs" from "authenticated";

revoke insert on table "public"."activity_logs" from "authenticated";

revoke references on table "public"."activity_logs" from "authenticated";

revoke select on table "public"."activity_logs" from "authenticated";

revoke trigger on table "public"."activity_logs" from "authenticated";

revoke truncate on table "public"."activity_logs" from "authenticated";

revoke update on table "public"."activity_logs" from "authenticated";

revoke delete on table "public"."activity_logs" from "service_role";

revoke insert on table "public"."activity_logs" from "service_role";

revoke references on table "public"."activity_logs" from "service_role";

revoke select on table "public"."activity_logs" from "service_role";

revoke trigger on table "public"."activity_logs" from "service_role";

revoke truncate on table "public"."activity_logs" from "service_role";

revoke update on table "public"."activity_logs" from "service_role";

revoke delete on table "public"."aircraft" from "anon";

revoke insert on table "public"."aircraft" from "anon";

revoke references on table "public"."aircraft" from "anon";

revoke select on table "public"."aircraft" from "anon";

revoke trigger on table "public"."aircraft" from "anon";

revoke truncate on table "public"."aircraft" from "anon";

revoke update on table "public"."aircraft" from "anon";

revoke delete on table "public"."aircraft" from "authenticated";

revoke insert on table "public"."aircraft" from "authenticated";

revoke references on table "public"."aircraft" from "authenticated";

revoke select on table "public"."aircraft" from "authenticated";

revoke trigger on table "public"."aircraft" from "authenticated";

revoke truncate on table "public"."aircraft" from "authenticated";

revoke update on table "public"."aircraft" from "authenticated";

revoke delete on table "public"."aircraft" from "service_role";

revoke insert on table "public"."aircraft" from "service_role";

revoke references on table "public"."aircraft" from "service_role";

revoke select on table "public"."aircraft" from "service_role";

revoke trigger on table "public"."aircraft" from "service_role";

revoke truncate on table "public"."aircraft" from "service_role";

revoke update on table "public"."aircraft" from "service_role";

revoke delete on table "public"."aircraft_consumables" from "anon";

revoke insert on table "public"."aircraft_consumables" from "anon";

revoke references on table "public"."aircraft_consumables" from "anon";

revoke select on table "public"."aircraft_consumables" from "anon";

revoke trigger on table "public"."aircraft_consumables" from "anon";

revoke truncate on table "public"."aircraft_consumables" from "anon";

revoke update on table "public"."aircraft_consumables" from "anon";

revoke delete on table "public"."aircraft_consumables" from "authenticated";

revoke insert on table "public"."aircraft_consumables" from "authenticated";

revoke references on table "public"."aircraft_consumables" from "authenticated";

revoke select on table "public"."aircraft_consumables" from "authenticated";

revoke trigger on table "public"."aircraft_consumables" from "authenticated";

revoke truncate on table "public"."aircraft_consumables" from "authenticated";

revoke update on table "public"."aircraft_consumables" from "authenticated";

revoke delete on table "public"."aircraft_consumables" from "service_role";

revoke insert on table "public"."aircraft_consumables" from "service_role";

revoke references on table "public"."aircraft_consumables" from "service_role";

revoke select on table "public"."aircraft_consumables" from "service_role";

revoke trigger on table "public"."aircraft_consumables" from "service_role";

revoke truncate on table "public"."aircraft_consumables" from "service_role";

revoke update on table "public"."aircraft_consumables" from "service_role";

revoke delete on table "public"."aircraft_fuel_status" from "anon";

revoke insert on table "public"."aircraft_fuel_status" from "anon";

revoke references on table "public"."aircraft_fuel_status" from "anon";

revoke select on table "public"."aircraft_fuel_status" from "anon";

revoke trigger on table "public"."aircraft_fuel_status" from "anon";

revoke truncate on table "public"."aircraft_fuel_status" from "anon";

revoke update on table "public"."aircraft_fuel_status" from "anon";

revoke insert on table "public"."aircraft_fuel_status" from "authenticated";

revoke references on table "public"."aircraft_fuel_status" from "authenticated";

revoke select on table "public"."aircraft_fuel_status" from "authenticated";

revoke trigger on table "public"."aircraft_fuel_status" from "authenticated";

revoke truncate on table "public"."aircraft_fuel_status" from "authenticated";

revoke delete on table "public"."aircraft_fuel_status" from "service_role";

revoke insert on table "public"."aircraft_fuel_status" from "service_role";

revoke references on table "public"."aircraft_fuel_status" from "service_role";

revoke select on table "public"."aircraft_fuel_status" from "service_role";

revoke trigger on table "public"."aircraft_fuel_status" from "service_role";

revoke truncate on table "public"."aircraft_fuel_status" from "service_role";

revoke update on table "public"."aircraft_fuel_status" from "service_role";

revoke delete on table "public"."client_billing_profiles" from "anon";

revoke insert on table "public"."client_billing_profiles" from "anon";

revoke references on table "public"."client_billing_profiles" from "anon";

revoke select on table "public"."client_billing_profiles" from "anon";

revoke trigger on table "public"."client_billing_profiles" from "anon";

revoke truncate on table "public"."client_billing_profiles" from "anon";

revoke update on table "public"."client_billing_profiles" from "anon";

revoke delete on table "public"."client_billing_profiles" from "authenticated";

revoke insert on table "public"."client_billing_profiles" from "authenticated";

revoke references on table "public"."client_billing_profiles" from "authenticated";

revoke select on table "public"."client_billing_profiles" from "authenticated";

revoke trigger on table "public"."client_billing_profiles" from "authenticated";

revoke truncate on table "public"."client_billing_profiles" from "authenticated";

revoke update on table "public"."client_billing_profiles" from "authenticated";

revoke delete on table "public"."client_billing_profiles" from "service_role";

revoke insert on table "public"."client_billing_profiles" from "service_role";

revoke references on table "public"."client_billing_profiles" from "service_role";

revoke select on table "public"."client_billing_profiles" from "service_role";

revoke trigger on table "public"."client_billing_profiles" from "service_role";

revoke truncate on table "public"."client_billing_profiles" from "service_role";

revoke update on table "public"."client_billing_profiles" from "service_role";

revoke delete on table "public"."client_fbo_cards" from "anon";

revoke insert on table "public"."client_fbo_cards" from "anon";

revoke references on table "public"."client_fbo_cards" from "anon";

revoke select on table "public"."client_fbo_cards" from "anon";

revoke trigger on table "public"."client_fbo_cards" from "anon";

revoke truncate on table "public"."client_fbo_cards" from "anon";

revoke update on table "public"."client_fbo_cards" from "anon";

revoke delete on table "public"."client_fbo_cards" from "authenticated";

revoke insert on table "public"."client_fbo_cards" from "authenticated";

revoke references on table "public"."client_fbo_cards" from "authenticated";

revoke select on table "public"."client_fbo_cards" from "authenticated";

revoke trigger on table "public"."client_fbo_cards" from "authenticated";

revoke truncate on table "public"."client_fbo_cards" from "authenticated";

revoke update on table "public"."client_fbo_cards" from "authenticated";

revoke delete on table "public"."client_fbo_cards" from "service_role";

revoke insert on table "public"."client_fbo_cards" from "service_role";

revoke references on table "public"."client_fbo_cards" from "service_role";

revoke select on table "public"."client_fbo_cards" from "service_role";

revoke trigger on table "public"."client_fbo_cards" from "service_role";

revoke truncate on table "public"."client_fbo_cards" from "service_role";

revoke update on table "public"."client_fbo_cards" from "service_role";

revoke delete on table "public"."documents" from "anon";

revoke insert on table "public"."documents" from "anon";

revoke references on table "public"."documents" from "anon";

revoke select on table "public"."documents" from "anon";

revoke trigger on table "public"."documents" from "anon";

revoke truncate on table "public"."documents" from "anon";

revoke update on table "public"."documents" from "anon";

revoke delete on table "public"."documents" from "authenticated";

revoke insert on table "public"."documents" from "authenticated";

revoke references on table "public"."documents" from "authenticated";

revoke select on table "public"."documents" from "authenticated";

revoke trigger on table "public"."documents" from "authenticated";

revoke truncate on table "public"."documents" from "authenticated";

revoke update on table "public"."documents" from "authenticated";

revoke delete on table "public"."documents" from "service_role";

revoke insert on table "public"."documents" from "service_role";

revoke references on table "public"."documents" from "service_role";

revoke select on table "public"."documents" from "service_role";

revoke trigger on table "public"."documents" from "service_role";

revoke truncate on table "public"."documents" from "service_role";

revoke update on table "public"."documents" from "service_role";

revoke delete on table "public"."fbos" from "anon";

revoke insert on table "public"."fbos" from "anon";

revoke references on table "public"."fbos" from "anon";

revoke select on table "public"."fbos" from "anon";

revoke trigger on table "public"."fbos" from "anon";

revoke truncate on table "public"."fbos" from "anon";

revoke update on table "public"."fbos" from "anon";

revoke delete on table "public"."fbos" from "authenticated";

revoke insert on table "public"."fbos" from "authenticated";

revoke references on table "public"."fbos" from "authenticated";

revoke select on table "public"."fbos" from "authenticated";

revoke trigger on table "public"."fbos" from "authenticated";

revoke truncate on table "public"."fbos" from "authenticated";

revoke update on table "public"."fbos" from "authenticated";

revoke delete on table "public"."fbos" from "service_role";

revoke insert on table "public"."fbos" from "service_role";

revoke references on table "public"."fbos" from "service_role";

revoke select on table "public"."fbos" from "service_role";

revoke trigger on table "public"."fbos" from "service_role";

revoke truncate on table "public"."fbos" from "service_role";

revoke update on table "public"."fbos" from "service_role";

revoke delete on table "public"."fuel_authorizations" from "anon";

revoke insert on table "public"."fuel_authorizations" from "anon";

revoke references on table "public"."fuel_authorizations" from "anon";

revoke select on table "public"."fuel_authorizations" from "anon";

revoke trigger on table "public"."fuel_authorizations" from "anon";

revoke truncate on table "public"."fuel_authorizations" from "anon";

revoke update on table "public"."fuel_authorizations" from "anon";

revoke delete on table "public"."fuel_authorizations" from "authenticated";

revoke insert on table "public"."fuel_authorizations" from "authenticated";

revoke references on table "public"."fuel_authorizations" from "authenticated";

revoke select on table "public"."fuel_authorizations" from "authenticated";

revoke trigger on table "public"."fuel_authorizations" from "authenticated";

revoke truncate on table "public"."fuel_authorizations" from "authenticated";

revoke update on table "public"."fuel_authorizations" from "authenticated";

revoke delete on table "public"."fuel_authorizations" from "service_role";

revoke insert on table "public"."fuel_authorizations" from "service_role";

revoke references on table "public"."fuel_authorizations" from "service_role";

revoke select on table "public"."fuel_authorizations" from "service_role";

revoke trigger on table "public"."fuel_authorizations" from "service_role";

revoke truncate on table "public"."fuel_authorizations" from "service_role";

revoke update on table "public"."fuel_authorizations" from "service_role";

revoke delete on table "public"."fuel_charges" from "anon";

revoke insert on table "public"."fuel_charges" from "anon";

revoke references on table "public"."fuel_charges" from "anon";

revoke select on table "public"."fuel_charges" from "anon";

revoke trigger on table "public"."fuel_charges" from "anon";

revoke truncate on table "public"."fuel_charges" from "anon";

revoke update on table "public"."fuel_charges" from "anon";

revoke delete on table "public"."fuel_charges" from "authenticated";

revoke insert on table "public"."fuel_charges" from "authenticated";

revoke references on table "public"."fuel_charges" from "authenticated";

revoke select on table "public"."fuel_charges" from "authenticated";

revoke trigger on table "public"."fuel_charges" from "authenticated";

revoke truncate on table "public"."fuel_charges" from "authenticated";

revoke update on table "public"."fuel_charges" from "authenticated";

revoke delete on table "public"."fuel_charges" from "service_role";

revoke insert on table "public"."fuel_charges" from "service_role";

revoke references on table "public"."fuel_charges" from "service_role";

revoke select on table "public"."fuel_charges" from "service_role";

revoke trigger on table "public"."fuel_charges" from "service_role";

revoke truncate on table "public"."fuel_charges" from "service_role";

revoke update on table "public"."fuel_charges" from "service_role";

revoke delete on table "public"."fuel_logs" from "anon";

revoke insert on table "public"."fuel_logs" from "anon";

revoke references on table "public"."fuel_logs" from "anon";

revoke select on table "public"."fuel_logs" from "anon";

revoke trigger on table "public"."fuel_logs" from "anon";

revoke truncate on table "public"."fuel_logs" from "anon";

revoke update on table "public"."fuel_logs" from "anon";

revoke delete on table "public"."fuel_logs" from "authenticated";

revoke insert on table "public"."fuel_logs" from "authenticated";

revoke references on table "public"."fuel_logs" from "authenticated";

revoke select on table "public"."fuel_logs" from "authenticated";

revoke trigger on table "public"."fuel_logs" from "authenticated";

revoke truncate on table "public"."fuel_logs" from "authenticated";

revoke update on table "public"."fuel_logs" from "authenticated";

revoke delete on table "public"."fuel_logs" from "service_role";

revoke insert on table "public"."fuel_logs" from "service_role";

revoke references on table "public"."fuel_logs" from "service_role";

revoke select on table "public"."fuel_logs" from "service_role";

revoke trigger on table "public"."fuel_logs" from "service_role";

revoke truncate on table "public"."fuel_logs" from "service_role";

revoke update on table "public"."fuel_logs" from "service_role";

revoke delete on table "public"."fuel_orders" from "anon";

revoke insert on table "public"."fuel_orders" from "anon";

revoke references on table "public"."fuel_orders" from "anon";

revoke select on table "public"."fuel_orders" from "anon";

revoke trigger on table "public"."fuel_orders" from "anon";

revoke truncate on table "public"."fuel_orders" from "anon";

revoke update on table "public"."fuel_orders" from "anon";

revoke delete on table "public"."fuel_orders" from "authenticated";

revoke insert on table "public"."fuel_orders" from "authenticated";

revoke references on table "public"."fuel_orders" from "authenticated";

revoke select on table "public"."fuel_orders" from "authenticated";

revoke trigger on table "public"."fuel_orders" from "authenticated";

revoke truncate on table "public"."fuel_orders" from "authenticated";

revoke update on table "public"."fuel_orders" from "authenticated";

revoke delete on table "public"."fuel_orders" from "service_role";

revoke insert on table "public"."fuel_orders" from "service_role";

revoke references on table "public"."fuel_orders" from "service_role";

revoke select on table "public"."fuel_orders" from "service_role";

revoke trigger on table "public"."fuel_orders" from "service_role";

revoke truncate on table "public"."fuel_orders" from "service_role";

revoke update on table "public"."fuel_orders" from "service_role";

revoke delete on table "public"."insurance_policies" from "anon";

revoke insert on table "public"."insurance_policies" from "anon";

revoke references on table "public"."insurance_policies" from "anon";

revoke select on table "public"."insurance_policies" from "anon";

revoke trigger on table "public"."insurance_policies" from "anon";

revoke truncate on table "public"."insurance_policies" from "anon";

revoke update on table "public"."insurance_policies" from "anon";

revoke delete on table "public"."insurance_policies" from "authenticated";

revoke insert on table "public"."insurance_policies" from "authenticated";

revoke references on table "public"."insurance_policies" from "authenticated";

revoke select on table "public"."insurance_policies" from "authenticated";

revoke trigger on table "public"."insurance_policies" from "authenticated";

revoke truncate on table "public"."insurance_policies" from "authenticated";

revoke update on table "public"."insurance_policies" from "authenticated";

revoke delete on table "public"."insurance_policies" from "service_role";

revoke insert on table "public"."insurance_policies" from "service_role";

revoke references on table "public"."insurance_policies" from "service_role";

revoke select on table "public"."insurance_policies" from "service_role";

revoke trigger on table "public"."insurance_policies" from "service_role";

revoke truncate on table "public"."insurance_policies" from "service_role";

revoke update on table "public"."insurance_policies" from "service_role";

revoke delete on table "public"."invoice_lines" from "anon";

revoke insert on table "public"."invoice_lines" from "anon";

revoke references on table "public"."invoice_lines" from "anon";

revoke select on table "public"."invoice_lines" from "anon";

revoke trigger on table "public"."invoice_lines" from "anon";

revoke truncate on table "public"."invoice_lines" from "anon";

revoke update on table "public"."invoice_lines" from "anon";

revoke delete on table "public"."invoice_lines" from "authenticated";

revoke insert on table "public"."invoice_lines" from "authenticated";

revoke references on table "public"."invoice_lines" from "authenticated";

revoke select on table "public"."invoice_lines" from "authenticated";

revoke trigger on table "public"."invoice_lines" from "authenticated";

revoke truncate on table "public"."invoice_lines" from "authenticated";

revoke update on table "public"."invoice_lines" from "authenticated";

revoke delete on table "public"."invoice_lines" from "service_role";

revoke insert on table "public"."invoice_lines" from "service_role";

revoke references on table "public"."invoice_lines" from "service_role";

revoke select on table "public"."invoice_lines" from "service_role";

revoke trigger on table "public"."invoice_lines" from "service_role";

revoke truncate on table "public"."invoice_lines" from "service_role";

revoke update on table "public"."invoice_lines" from "service_role";

revoke delete on table "public"."invoices" from "anon";

revoke insert on table "public"."invoices" from "anon";

revoke references on table "public"."invoices" from "anon";

revoke select on table "public"."invoices" from "anon";

revoke trigger on table "public"."invoices" from "anon";

revoke truncate on table "public"."invoices" from "anon";

revoke update on table "public"."invoices" from "anon";

revoke delete on table "public"."invoices" from "authenticated";

revoke insert on table "public"."invoices" from "authenticated";

revoke references on table "public"."invoices" from "authenticated";

revoke select on table "public"."invoices" from "authenticated";

revoke trigger on table "public"."invoices" from "authenticated";

revoke truncate on table "public"."invoices" from "authenticated";

revoke update on table "public"."invoices" from "authenticated";

revoke delete on table "public"."invoices" from "service_role";

revoke insert on table "public"."invoices" from "service_role";

revoke references on table "public"."invoices" from "service_role";

revoke select on table "public"."invoices" from "service_role";

revoke trigger on table "public"."invoices" from "service_role";

revoke truncate on table "public"."invoices" from "service_role";

revoke update on table "public"."invoices" from "service_role";

revoke delete on table "public"."maintenance_due" from "anon";

revoke insert on table "public"."maintenance_due" from "anon";

revoke references on table "public"."maintenance_due" from "anon";

revoke select on table "public"."maintenance_due" from "anon";

revoke trigger on table "public"."maintenance_due" from "anon";

revoke truncate on table "public"."maintenance_due" from "anon";

revoke update on table "public"."maintenance_due" from "anon";

revoke delete on table "public"."maintenance_due" from "authenticated";

revoke insert on table "public"."maintenance_due" from "authenticated";

revoke references on table "public"."maintenance_due" from "authenticated";

revoke select on table "public"."maintenance_due" from "authenticated";

revoke trigger on table "public"."maintenance_due" from "authenticated";

revoke truncate on table "public"."maintenance_due" from "authenticated";

revoke update on table "public"."maintenance_due" from "authenticated";

revoke delete on table "public"."maintenance_due" from "service_role";

revoke insert on table "public"."maintenance_due" from "service_role";

revoke references on table "public"."maintenance_due" from "service_role";

revoke select on table "public"."maintenance_due" from "service_role";

revoke trigger on table "public"."maintenance_due" from "service_role";

revoke truncate on table "public"."maintenance_due" from "service_role";

revoke update on table "public"."maintenance_due" from "service_role";

revoke delete on table "public"."membership_tiers" from "anon";

revoke insert on table "public"."membership_tiers" from "anon";

revoke references on table "public"."membership_tiers" from "anon";

revoke select on table "public"."membership_tiers" from "anon";

revoke trigger on table "public"."membership_tiers" from "anon";

revoke truncate on table "public"."membership_tiers" from "anon";

revoke update on table "public"."membership_tiers" from "anon";

revoke delete on table "public"."membership_tiers" from "authenticated";

revoke insert on table "public"."membership_tiers" from "authenticated";

revoke references on table "public"."membership_tiers" from "authenticated";

revoke select on table "public"."membership_tiers" from "authenticated";

revoke trigger on table "public"."membership_tiers" from "authenticated";

revoke truncate on table "public"."membership_tiers" from "authenticated";

revoke update on table "public"."membership_tiers" from "authenticated";

revoke delete on table "public"."membership_tiers" from "service_role";

revoke insert on table "public"."membership_tiers" from "service_role";

revoke references on table "public"."membership_tiers" from "service_role";

revoke select on table "public"."membership_tiers" from "service_role";

revoke trigger on table "public"."membership_tiers" from "service_role";

revoke truncate on table "public"."membership_tiers" from "service_role";

revoke update on table "public"."membership_tiers" from "service_role";

revoke delete on table "public"."memberships" from "anon";

revoke insert on table "public"."memberships" from "anon";

revoke references on table "public"."memberships" from "anon";

revoke select on table "public"."memberships" from "anon";

revoke trigger on table "public"."memberships" from "anon";

revoke truncate on table "public"."memberships" from "anon";

revoke update on table "public"."memberships" from "anon";

revoke delete on table "public"."memberships" from "authenticated";

revoke insert on table "public"."memberships" from "authenticated";

revoke references on table "public"."memberships" from "authenticated";

revoke select on table "public"."memberships" from "authenticated";

revoke trigger on table "public"."memberships" from "authenticated";

revoke truncate on table "public"."memberships" from "authenticated";

revoke update on table "public"."memberships" from "authenticated";

revoke delete on table "public"."memberships" from "service_role";

revoke insert on table "public"."memberships" from "service_role";

revoke references on table "public"."memberships" from "service_role";

revoke select on table "public"."memberships" from "service_role";

revoke trigger on table "public"."memberships" from "service_role";

revoke truncate on table "public"."memberships" from "service_role";

revoke update on table "public"."memberships" from "service_role";

revoke delete on table "public"."notifications" from "anon";

revoke insert on table "public"."notifications" from "anon";

revoke references on table "public"."notifications" from "anon";

revoke select on table "public"."notifications" from "anon";

revoke trigger on table "public"."notifications" from "anon";

revoke truncate on table "public"."notifications" from "anon";

revoke update on table "public"."notifications" from "anon";

revoke delete on table "public"."notifications" from "authenticated";

revoke insert on table "public"."notifications" from "authenticated";

revoke references on table "public"."notifications" from "authenticated";

revoke select on table "public"."notifications" from "authenticated";

revoke trigger on table "public"."notifications" from "authenticated";

revoke truncate on table "public"."notifications" from "authenticated";

revoke update on table "public"."notifications" from "authenticated";

revoke delete on table "public"."notifications" from "service_role";

revoke insert on table "public"."notifications" from "service_role";

revoke references on table "public"."notifications" from "service_role";

revoke select on table "public"."notifications" from "service_role";

revoke trigger on table "public"."notifications" from "service_role";

revoke truncate on table "public"."notifications" from "service_role";

revoke update on table "public"."notifications" from "service_role";

revoke delete on table "public"."payment_methods" from "anon";

revoke insert on table "public"."payment_methods" from "anon";

revoke references on table "public"."payment_methods" from "anon";

revoke select on table "public"."payment_methods" from "anon";

revoke trigger on table "public"."payment_methods" from "anon";

revoke truncate on table "public"."payment_methods" from "anon";

revoke update on table "public"."payment_methods" from "anon";

revoke delete on table "public"."payment_methods" from "authenticated";

revoke insert on table "public"."payment_methods" from "authenticated";

revoke references on table "public"."payment_methods" from "authenticated";

revoke select on table "public"."payment_methods" from "authenticated";

revoke trigger on table "public"."payment_methods" from "authenticated";

revoke truncate on table "public"."payment_methods" from "authenticated";

revoke update on table "public"."payment_methods" from "authenticated";

revoke delete on table "public"."payment_methods" from "service_role";

revoke insert on table "public"."payment_methods" from "service_role";

revoke references on table "public"."payment_methods" from "service_role";

revoke select on table "public"."payment_methods" from "service_role";

revoke trigger on table "public"."payment_methods" from "service_role";

revoke truncate on table "public"."payment_methods" from "service_role";

revoke update on table "public"."payment_methods" from "service_role";

revoke delete on table "public"."pilot_currency" from "anon";

revoke insert on table "public"."pilot_currency" from "anon";

revoke references on table "public"."pilot_currency" from "anon";

revoke select on table "public"."pilot_currency" from "anon";

revoke trigger on table "public"."pilot_currency" from "anon";

revoke truncate on table "public"."pilot_currency" from "anon";

revoke update on table "public"."pilot_currency" from "anon";

revoke delete on table "public"."pilot_currency" from "authenticated";

revoke insert on table "public"."pilot_currency" from "authenticated";

revoke references on table "public"."pilot_currency" from "authenticated";

revoke select on table "public"."pilot_currency" from "authenticated";

revoke trigger on table "public"."pilot_currency" from "authenticated";

revoke truncate on table "public"."pilot_currency" from "authenticated";

revoke update on table "public"."pilot_currency" from "authenticated";

revoke delete on table "public"."pilot_currency" from "service_role";

revoke insert on table "public"."pilot_currency" from "service_role";

revoke references on table "public"."pilot_currency" from "service_role";

revoke select on table "public"."pilot_currency" from "service_role";

revoke trigger on table "public"."pilot_currency" from "service_role";

revoke truncate on table "public"."pilot_currency" from "service_role";

revoke update on table "public"."pilot_currency" from "service_role";

revoke delete on table "public"."profiles" from "anon";

revoke insert on table "public"."profiles" from "anon";

revoke references on table "public"."profiles" from "anon";

revoke select on table "public"."profiles" from "anon";

revoke trigger on table "public"."profiles" from "anon";

revoke truncate on table "public"."profiles" from "anon";

revoke update on table "public"."profiles" from "anon";

revoke delete on table "public"."profiles" from "authenticated";

revoke insert on table "public"."profiles" from "authenticated";

revoke references on table "public"."profiles" from "authenticated";

revoke select on table "public"."profiles" from "authenticated";

revoke trigger on table "public"."profiles" from "authenticated";

revoke truncate on table "public"."profiles" from "authenticated";

revoke update on table "public"."profiles" from "authenticated";

revoke delete on table "public"."profiles" from "service_role";

revoke insert on table "public"."profiles" from "service_role";

revoke references on table "public"."profiles" from "service_role";

revoke select on table "public"."profiles" from "service_role";

revoke trigger on table "public"."profiles" from "service_role";

revoke truncate on table "public"."profiles" from "service_role";

revoke update on table "public"."profiles" from "service_role";

revoke delete on table "public"."reservations" from "anon";

revoke insert on table "public"."reservations" from "anon";

revoke references on table "public"."reservations" from "anon";

revoke select on table "public"."reservations" from "anon";

revoke trigger on table "public"."reservations" from "anon";

revoke truncate on table "public"."reservations" from "anon";

revoke update on table "public"."reservations" from "anon";

revoke delete on table "public"."reservations" from "authenticated";

revoke insert on table "public"."reservations" from "authenticated";

revoke references on table "public"."reservations" from "authenticated";

revoke select on table "public"."reservations" from "authenticated";

revoke trigger on table "public"."reservations" from "authenticated";

revoke truncate on table "public"."reservations" from "authenticated";

revoke update on table "public"."reservations" from "authenticated";

revoke delete on table "public"."reservations" from "service_role";

revoke insert on table "public"."reservations" from "service_role";

revoke references on table "public"."reservations" from "service_role";

revoke select on table "public"."reservations" from "service_role";

revoke trigger on table "public"."reservations" from "service_role";

revoke truncate on table "public"."reservations" from "service_role";

revoke update on table "public"."reservations" from "service_role";

revoke delete on table "public"."service_credits" from "anon";

revoke insert on table "public"."service_credits" from "anon";

revoke references on table "public"."service_credits" from "anon";

revoke select on table "public"."service_credits" from "anon";

revoke trigger on table "public"."service_credits" from "anon";

revoke truncate on table "public"."service_credits" from "anon";

revoke update on table "public"."service_credits" from "anon";

revoke delete on table "public"."service_credits" from "authenticated";

revoke insert on table "public"."service_credits" from "authenticated";

revoke references on table "public"."service_credits" from "authenticated";

revoke select on table "public"."service_credits" from "authenticated";

revoke trigger on table "public"."service_credits" from "authenticated";

revoke truncate on table "public"."service_credits" from "authenticated";

revoke update on table "public"."service_credits" from "authenticated";

revoke delete on table "public"."service_credits" from "service_role";

revoke insert on table "public"."service_credits" from "service_role";

revoke references on table "public"."service_credits" from "service_role";

revoke select on table "public"."service_credits" from "service_role";

revoke trigger on table "public"."service_credits" from "service_role";

revoke truncate on table "public"."service_credits" from "service_role";

revoke update on table "public"."service_credits" from "service_role";

revoke delete on table "public"."service_requests" from "anon";

revoke insert on table "public"."service_requests" from "anon";

revoke references on table "public"."service_requests" from "anon";

revoke select on table "public"."service_requests" from "anon";

revoke trigger on table "public"."service_requests" from "anon";

revoke truncate on table "public"."service_requests" from "anon";

revoke update on table "public"."service_requests" from "anon";

revoke delete on table "public"."service_requests" from "authenticated";

revoke insert on table "public"."service_requests" from "authenticated";

revoke references on table "public"."service_requests" from "authenticated";

revoke select on table "public"."service_requests" from "authenticated";

revoke trigger on table "public"."service_requests" from "authenticated";

revoke truncate on table "public"."service_requests" from "authenticated";

revoke update on table "public"."service_requests" from "authenticated";

revoke delete on table "public"."service_requests" from "service_role";

revoke insert on table "public"."service_requests" from "service_role";

revoke references on table "public"."service_requests" from "service_role";

revoke select on table "public"."service_requests" from "service_role";

revoke trigger on table "public"."service_requests" from "service_role";

revoke truncate on table "public"."service_requests" from "service_role";

revoke update on table "public"."service_requests" from "service_role";

revoke delete on table "public"."service_tasks" from "anon";

revoke insert on table "public"."service_tasks" from "anon";

revoke references on table "public"."service_tasks" from "anon";

revoke select on table "public"."service_tasks" from "anon";

revoke trigger on table "public"."service_tasks" from "anon";

revoke truncate on table "public"."service_tasks" from "anon";

revoke update on table "public"."service_tasks" from "anon";

revoke delete on table "public"."service_tasks" from "authenticated";

revoke insert on table "public"."service_tasks" from "authenticated";

revoke references on table "public"."service_tasks" from "authenticated";

revoke select on table "public"."service_tasks" from "authenticated";

revoke trigger on table "public"."service_tasks" from "authenticated";

revoke truncate on table "public"."service_tasks" from "authenticated";

revoke update on table "public"."service_tasks" from "authenticated";

revoke delete on table "public"."service_tasks" from "service_role";

revoke insert on table "public"."service_tasks" from "service_role";

revoke references on table "public"."service_tasks" from "service_role";

revoke select on table "public"."service_tasks" from "service_role";

revoke trigger on table "public"."service_tasks" from "service_role";

revoke truncate on table "public"."service_tasks" from "service_role";

revoke update on table "public"."service_tasks" from "service_role";

revoke delete on table "public"."services" from "anon";

revoke insert on table "public"."services" from "anon";

revoke references on table "public"."services" from "anon";

revoke select on table "public"."services" from "anon";

revoke trigger on table "public"."services" from "anon";

revoke truncate on table "public"."services" from "anon";

revoke update on table "public"."services" from "anon";

revoke delete on table "public"."services" from "authenticated";

revoke insert on table "public"."services" from "authenticated";

revoke references on table "public"."services" from "authenticated";

revoke select on table "public"."services" from "authenticated";

revoke trigger on table "public"."services" from "authenticated";

revoke truncate on table "public"."services" from "authenticated";

revoke update on table "public"."services" from "authenticated";

revoke delete on table "public"."services" from "service_role";

revoke insert on table "public"."services" from "service_role";

revoke references on table "public"."services" from "service_role";

revoke select on table "public"."services" from "service_role";

revoke trigger on table "public"."services" from "service_role";

revoke truncate on table "public"."services" from "service_role";

revoke update on table "public"."services" from "service_role";

revoke delete on table "public"."settings" from "anon";

revoke insert on table "public"."settings" from "anon";

revoke references on table "public"."settings" from "anon";

revoke select on table "public"."settings" from "anon";

revoke trigger on table "public"."settings" from "anon";

revoke truncate on table "public"."settings" from "anon";

revoke update on table "public"."settings" from "anon";

revoke delete on table "public"."settings" from "authenticated";

revoke insert on table "public"."settings" from "authenticated";

revoke references on table "public"."settings" from "authenticated";

revoke select on table "public"."settings" from "authenticated";

revoke trigger on table "public"."settings" from "authenticated";

revoke truncate on table "public"."settings" from "authenticated";

revoke update on table "public"."settings" from "authenticated";

revoke delete on table "public"."settings" from "service_role";

revoke insert on table "public"."settings" from "service_role";

revoke references on table "public"."settings" from "service_role";

revoke select on table "public"."settings" from "service_role";

revoke trigger on table "public"."settings" from "service_role";

revoke truncate on table "public"."settings" from "service_role";

revoke update on table "public"."settings" from "service_role";

revoke delete on table "public"."support_tickets" from "anon";

revoke insert on table "public"."support_tickets" from "anon";

revoke references on table "public"."support_tickets" from "anon";

revoke select on table "public"."support_tickets" from "anon";

revoke trigger on table "public"."support_tickets" from "anon";

revoke truncate on table "public"."support_tickets" from "anon";

revoke update on table "public"."support_tickets" from "anon";

revoke delete on table "public"."support_tickets" from "authenticated";

revoke insert on table "public"."support_tickets" from "authenticated";

revoke references on table "public"."support_tickets" from "authenticated";

revoke select on table "public"."support_tickets" from "authenticated";

revoke trigger on table "public"."support_tickets" from "authenticated";

revoke truncate on table "public"."support_tickets" from "authenticated";

revoke update on table "public"."support_tickets" from "authenticated";

revoke delete on table "public"."support_tickets" from "service_role";

revoke insert on table "public"."support_tickets" from "service_role";

revoke references on table "public"."support_tickets" from "service_role";

revoke select on table "public"."support_tickets" from "service_role";

revoke trigger on table "public"."support_tickets" from "service_role";

revoke truncate on table "public"."support_tickets" from "service_role";

revoke update on table "public"."support_tickets" from "service_role";

revoke delete on table "public"."user_roles" from "anon";

revoke insert on table "public"."user_roles" from "anon";

revoke references on table "public"."user_roles" from "anon";

revoke select on table "public"."user_roles" from "anon";

revoke trigger on table "public"."user_roles" from "anon";

revoke truncate on table "public"."user_roles" from "anon";

revoke update on table "public"."user_roles" from "anon";

revoke delete on table "public"."user_roles" from "authenticated";

revoke insert on table "public"."user_roles" from "authenticated";

revoke references on table "public"."user_roles" from "authenticated";

revoke select on table "public"."user_roles" from "authenticated";

revoke trigger on table "public"."user_roles" from "authenticated";

revoke truncate on table "public"."user_roles" from "authenticated";

revoke update on table "public"."user_roles" from "authenticated";

revoke delete on table "public"."user_roles" from "service_role";

revoke insert on table "public"."user_roles" from "service_role";

revoke references on table "public"."user_roles" from "service_role";

revoke select on table "public"."user_roles" from "service_role";

revoke trigger on table "public"."user_roles" from "service_role";

revoke truncate on table "public"."user_roles" from "service_role";

revoke update on table "public"."user_roles" from "service_role";

alter table "public"."aircraft" drop constraint "aircraft_owner_id_fkey";

alter table "public"."service_requests" drop constraint "service_requests_user_id_fkey";

alter table "public"."activity_logs" alter column "metadata" set default '{}'::jsonb;

alter table "public"."aircraft_consumables" add column "created_at" timestamp with time zone not null default now();

alter table "public"."aircraft_consumables" add column "updated_at" timestamp with time zone not null default now();

alter table "public"."aircraft_consumables" alter column "last_updated" set default now();

alter table "public"."aircraft_consumables" alter column "o2_pct" set data type integer using "o2_pct"::integer;

alter table "public"."aircraft_consumables" alter column "tks_pct" set data type integer using "tks_pct"::integer;

alter table "public"."aircraft_consumables" enable row level security;

alter table "public"."documents" add column "storage_path" text;

alter table "public"."documents" add column "updated_at" timestamp with time zone not null default now();

alter table "public"."documents" alter column "created_at" set not null;

alter table "public"."documents" alter column "status" set default 'pending_upload'::text;

alter table "public"."documents" enable row level security;

alter table "public"."insurance_policies" add column "created_at" timestamp with time zone not null default now();

alter table "public"."insurance_policies" add column "updated_at" timestamp with time zone not null default now();

alter table "public"."insurance_policies" enable row level security;

alter table "public"."maintenance_due" add column "created_at" timestamp with time zone not null default now();

alter table "public"."maintenance_due" add column "updated_at" timestamp with time zone not null default now();

alter table "public"."maintenance_due" alter column "severity" set default 'normal'::text;

alter table "public"."maintenance_due" enable row level security;

alter table "public"."notifications" alter column "created_at" set not null;

alter table "public"."notifications" alter column "level" set default 'info'::text;

alter table "public"."notifications" enable row level security;

alter table "public"."payment_methods" add column "created_at" timestamp with time zone not null default now();

alter table "public"."payment_methods" add column "updated_at" timestamp with time zone not null default now();

alter table "public"."payment_methods" alter column "is_default" set default false;

alter table "public"."payment_methods" alter column "is_default" set not null;

alter table "public"."payment_methods" enable row level security;

alter table "public"."pilot_currency" add column "created_at" timestamp with time zone not null default now();

alter table "public"."pilot_currency" add column "updated_at" timestamp with time zone not null default now();

alter table "public"."pilot_currency" enable row level security;

alter table "public"."reservations" alter column "created_at" set not null;

alter table "public"."reservations" alter column "status" set default 'requested'::text;

alter table "public"."reservations" alter column "updated_at" set not null;

alter table "public"."reservations" enable row level security;

alter table "public"."service_requests" alter column "cabin_provisioning" set default '{}'::jsonb;

alter table "public"."service_requests" alter column "fuel_quantity" set data type numeric(6,2) using "fuel_quantity"::numeric(6,2);

alter table "public"."service_requests" alter column "gpu_required" drop default;

alter table "public"."service_requests" alter column "hangar_pullout" drop default;

alter table "public"."service_requests" alter column "o2_topoff" drop default;

alter table "public"."service_requests" alter column "tks_topoff" drop default;

alter table "public"."support_tickets" alter column "created_at" set not null;

alter table "public"."support_tickets" alter column "status" set default 'open'::text;

alter table "public"."support_tickets" alter column "updated_at" set not null;

alter table "public"."support_tickets" enable row level security;

CREATE INDEX idx_aircraft_owner ON public.aircraft USING btree (owner_id);

CREATE INDEX idx_documents_aircraft ON public.documents USING btree (aircraft_id);

CREATE INDEX idx_documents_owner ON public.documents USING btree (owner_id);

CREATE INDEX idx_maintenance_due_aircraft ON public.maintenance_due USING btree (aircraft_id);

CREATE INDEX idx_maintenance_due_severity ON public.maintenance_due USING btree (severity);

CREATE INDEX idx_notifications_unread ON public.notifications USING btree (user_id, read_at);

CREATE INDEX idx_notifications_user ON public.notifications USING btree (user_id);

CREATE INDEX idx_payment_methods_default ON public.payment_methods USING btree (owner_id, is_default);

CREATE INDEX idx_payment_methods_owner ON public.payment_methods USING btree (owner_id);

CREATE INDEX idx_reservations_aircraft ON public.reservations USING btree (aircraft_id);

CREATE INDEX idx_reservations_owner ON public.reservations USING btree (owner_id);

CREATE INDEX idx_reservations_start ON public.reservations USING btree (start_at);

CREATE INDEX idx_service_requests_airport ON public.service_requests USING btree (airport);

CREATE INDEX idx_sr_aircraft ON public.service_requests USING btree (aircraft_id);

CREATE INDEX idx_sr_created_at ON public.service_requests USING btree (created_at);

CREATE INDEX idx_sr_status ON public.service_requests USING btree (status);

CREATE INDEX idx_support_tickets_owner ON public.support_tickets USING btree (owner_id);

CREATE INDEX idx_support_tickets_status ON public.support_tickets USING btree (status);

CREATE UNIQUE INDEX one_active_aircraft_per_owner ON public.aircraft USING btree (owner_id) WHERE (status = 'active'::text);

CREATE UNIQUE INDEX ux_user_roles_user_role ON public.user_roles USING btree (user_id, role);

alter table "public"."aircraft_consumables" add constraint "aircraft_consumables_aircraft_id_fkey" FOREIGN KEY (aircraft_id) REFERENCES aircraft(id) ON DELETE CASCADE not valid;

alter table "public"."aircraft_consumables" validate constraint "aircraft_consumables_aircraft_id_fkey";

alter table "public"."documents" add constraint "documents_aircraft_id_fkey" FOREIGN KEY (aircraft_id) REFERENCES aircraft(id) ON DELETE CASCADE not valid;

alter table "public"."documents" validate constraint "documents_aircraft_id_fkey";

alter table "public"."documents" add constraint "documents_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."documents" validate constraint "documents_owner_id_fkey";

alter table "public"."insurance_policies" add constraint "insurance_policies_aircraft_id_fkey" FOREIGN KEY (aircraft_id) REFERENCES aircraft(id) ON DELETE CASCADE not valid;

alter table "public"."insurance_policies" validate constraint "insurance_policies_aircraft_id_fkey";

alter table "public"."invoices" add constraint "invoices_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."invoices" validate constraint "invoices_owner_id_fkey";

alter table "public"."maintenance_due" add constraint "maintenance_due_aircraft_id_fkey" FOREIGN KEY (aircraft_id) REFERENCES aircraft(id) ON DELETE CASCADE not valid;

alter table "public"."maintenance_due" validate constraint "maintenance_due_aircraft_id_fkey";

alter table "public"."notifications" add constraint "notifications_user_id_fkey" FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."notifications" validate constraint "notifications_user_id_fkey";

alter table "public"."payment_methods" add constraint "payment_methods_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."payment_methods" validate constraint "payment_methods_owner_id_fkey";

alter table "public"."pilot_currency" add constraint "pilot_currency_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."pilot_currency" validate constraint "pilot_currency_owner_id_fkey";

alter table "public"."reservations" add constraint "reservations_aircraft_id_fkey" FOREIGN KEY (aircraft_id) REFERENCES aircraft(id) ON DELETE CASCADE not valid;

alter table "public"."reservations" validate constraint "reservations_aircraft_id_fkey";

alter table "public"."reservations" add constraint "reservations_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."reservations" validate constraint "reservations_owner_id_fkey";

alter table "public"."service_requests" add constraint "chk_sr_airport_icao" CHECK (((airport IS NULL) OR ((length(airport) >= 3) AND (length(airport) <= 4)))) not valid;

alter table "public"."service_requests" validate constraint "chk_sr_airport_icao";

alter table "public"."service_requests" add constraint "service_requests_fuel_grade_check" CHECK ((fuel_grade = ANY (ARRAY['100LL'::text, 'Jet-A'::text, 'Jet-A+'::text, 'MOGAS'::text]))) not valid;

alter table "public"."service_requests" validate constraint "service_requests_fuel_grade_check";

alter table "public"."support_tickets" add constraint "support_tickets_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."support_tickets" validate constraint "support_tickets_owner_id_fkey";

alter table "public"."aircraft" add constraint "aircraft_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."aircraft" validate constraint "aircraft_owner_id_fkey";

alter table "public"."service_requests" add constraint "service_requests_user_id_fkey" FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."service_requests" validate constraint "service_requests_user_id_fkey";

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.set_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  new.updated_at = now();
  return new;
end$function$
;

CREATE OR REPLACE FUNCTION public.tg_set_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  new.updated_at := now();
  return new;
end;
$function$
;

create or replace view "public"."v_memberships" as  SELECT m.id,
    m.owner_id,
    m.tier,
    m.start_date,
    m.end_date,
    m.active,
    m.created_at,
    m.updated_at,
    m.tier_id,
    t.name AS tier_name,
    t.base_price
   FROM (memberships m
     LEFT JOIN membership_tiers t ON ((t.id = m.tier_id)));


create or replace view "public"."v_owner_aircraft" as  SELECT id,
    tail_number,
    model,
    owner_id,
    base_location,
    status,
    created_at,
    updated_at,
    hobbs_time,
    tach_time
   FROM aircraft a
  WHERE (owner_id = auth.uid());


create or replace view "public"."v_service_requests" as  SELECT r.id,
    r.user_id,
    r.aircraft_id,
    r.service_type,
    r.description,
    r.priority,
    r.status,
    r.created_at,
    r.updated_at,
    r.airport,
    r.service_id,
    r.is_extra_charge,
    r.credits_used,
    r.requested_departure,
    r.fuel_grade,
    r.fuel_quantity,
    r.cabin_provisioning,
    r.o2_topoff,
    r.tks_topoff,
    r.gpu_required,
    r.hangar_pullout,
    a.tail_number,
    a.base_location,
    p.full_name AS requester_name
   FROM ((service_requests r
     LEFT JOIN aircraft a ON ((a.id = r.aircraft_id)))
     LEFT JOIN profiles p ON ((p.id = r.user_id)));


CREATE OR REPLACE FUNCTION public.afs_enforce_capacity()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
DECLARE
  max_usable numeric(6,1);
BEGIN
  SELECT a.usable_fuel_gal INTO max_usable
  FROM public.aircraft a
  WHERE a.id = NEW.aircraft_id;

  IF max_usable IS NOT NULL AND NEW.gallons_onboard > max_usable THEN
    RAISE EXCEPTION 'gallons_onboard (%.1f) exceeds aircraft usable fuel (%.1f) for aircraft %',
      NEW.gallons_onboard, max_usable, NEW.aircraft_id;
  END IF;

  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.after_fuel_log_create_charge()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
DECLARE
  owner uuid;
  rate numeric;
  order_directive text;
BEGIN
  SELECT a.owner_id INTO owner FROM public.aircraft a WHERE a.id = NEW.aircraft_id;
  SELECT default_fuel_rate INTO rate FROM public.settings LIMIT 1;

  SELECT fo.applied_directive INTO order_directive
  FROM public.fuel_orders fo
  WHERE fo.aircraft_id = NEW.aircraft_id
    AND fo.requested_at > now() - interval '6 hours'
  ORDER BY fo.requested_at DESC
  LIMIT 1;

  IF order_directive = 'FA_CARD_REBILL_CLIENT' THEN
    INSERT INTO public.fuel_charges(
      fuel_log_id, aircraft_id, client_id, gallons, unit_price, paid_via, payment_status
    ) VALUES (
      NEW.id, NEW.aircraft_id, owner, NEW.quantity, COALESCE(rate,0), 'FA_CORP_CARD', 'pending'
    );
  ELSIF order_directive = 'DIRECT_TO_FBO_CLIENT_CARD' THEN
    INSERT INTO public.fuel_charges(
      fuel_log_id, aircraft_id, client_id, gallons, unit_price, paid_via, payment_status
    ) VALUES (
      NEW.id, NEW.aircraft_id, owner, NEW.quantity, COALESCE(rate,0), 'CLIENT_CARD_ON_FILE', 'external_paid'
    );
  END IF;

  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.after_fuel_log_update_status()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
DECLARE
  full_gal numeric(6,1);
  prev_gal numeric(6,1);
  new_gal numeric(6,1);
BEGIN
  SELECT a.usable_fuel_gal INTO full_gal FROM public.aircraft a WHERE a.id = NEW.aircraft_id;
  SELECT v.gallons_onboard INTO prev_gal FROM public.v_aircraft_fuel_latest v WHERE v.aircraft_id = NEW.aircraft_id;
  IF prev_gal IS NULL THEN prev_gal := 0; END IF;
  new_gal := LEAST(prev_gal + NEW.quantity, COALESCE(full_gal, prev_gal + NEW.quantity));
  INSERT INTO public.aircraft_fuel_status (aircraft_id, gallons_onboard, method, notes)
  VALUES (NEW.aircraft_id, new_gal, 'fuel_log', 'Auto from fueling');
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.assign_default_role()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
BEGIN
  INSERT INTO public.user_roles (user_id, role)
  VALUES (NEW.id, 'owner'::app_role)
  ON CONFLICT (user_id, role) DO NOTHING;
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.fuel_logs_set_type()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  SELECT a.fuel_type INTO NEW.fuel_type
  FROM public.aircraft a
  WHERE a.id = NEW.aircraft_id;
  IF NEW.fuel_type IS NULL THEN
    RAISE EXCEPTION 'Aircraft % has no fuel_type', NEW.aircraft_id;
  END IF;
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.fuel_orders_apply_directive()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  IF NEW.applied_fbo_id IS NULL THEN
    RETURN NEW;
  END IF;

  SELECT fa.directive INTO NEW.applied_directive
  FROM public.fuel_authorizations fa
  WHERE fa.aircraft_id = NEW.aircraft_id
    AND fa.fbo_id = NEW.applied_fbo_id
    AND fa.active = true
  LIMIT 1;

  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.fuel_orders_compute()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
DECLARE
  full_gal numeric(6,1);
  tabs_gal numeric(6,1);
  current_gal numeric(6,1);
BEGIN
  SELECT a.fuel_type, a.usable_fuel_gal, a.tabs_fuel_gal
    INTO NEW.fuel_type, full_gal, tabs_gal
  FROM public.aircraft a WHERE a.id = NEW.aircraft_id;

  IF NEW.fuel_type IS NULL OR full_gal IS NULL OR tabs_gal IS NULL THEN
    RAISE EXCEPTION 'Aircraft % missing fuel_type/usable/tabs', NEW.aircraft_id;
  END IF;

  SELECT v.gallons_onboard INTO current_gal FROM public.v_aircraft_fuel_latest v WHERE v.aircraft_id = NEW.aircraft_id;
  IF current_gal IS NULL THEN current_gal := 0; END IF;

  NEW.snapshot_gal_onboard := current_gal;

  IF NEW.target = 'ADD_QUANTITY' THEN
    IF NEW.add_quantity_gal IS NULL OR NEW.add_quantity_gal <= 0 THEN
      RAISE EXCEPTION 'add_quantity_gal must be > 0';
    END IF;
    NEW.computed_add_gal := LEAST(NEW.add_quantity_gal, GREATEST(full_gal - current_gal, 0));

  ELSIF NEW.target = 'FILL_TO_TABS' THEN
    NEW.computed_add_gal := GREATEST(tabs_gal - current_gal, 0);

  ELSIF NEW.target = 'FILL_TO_TABS_PLUS' THEN
    IF NEW.tabs_plus_gal IS NULL OR NEW.tabs_plus_gal < 0 THEN
      RAISE EXCEPTION 'tabs_plus_gal must be >= 0';
    END IF;
    NEW.computed_add_gal := GREATEST(LEAST(tabs_gal + NEW.tabs_plus_gal, full_gal) - current_gal, 0);

  ELSIF NEW.target = 'FILL_TO_FULL' THEN
    NEW.computed_add_gal := GREATEST(full_gal - current_gal, 0);
  END IF;

  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.handle_new_user()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
BEGIN
  -- Insert into profiles table
  INSERT INTO public.profiles (id, email, full_name)
  VALUES (
    NEW.id,
    NEW.email,
    COALESCE(NEW.raw_user_meta_data->>'full_name', NEW.email)
  );
  
  -- Assign default role (owner) to new users
  INSERT INTO public.user_roles (user_id, role)
  VALUES (NEW.id, 'owner');
  
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.handle_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.has_role(_user_id uuid, _role app_role)
 RETURNS boolean
 LANGUAGE sql
 STABLE SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
  SELECT EXISTS (
    SELECT 1
    FROM public.user_roles
    WHERE user_id = _user_id AND role = _role
  )
$function$
;

CREATE OR REPLACE FUNCTION public.set_fuel_snapshot(p_aircraft uuid, p_gal numeric, p_method fuel_status_method DEFAULT 'manual'::fuel_status_method, p_notes text DEFAULT NULL::text)
 RETURNS void
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
BEGIN
  INSERT INTO public.aircraft_fuel_status(aircraft_id, gallons_onboard, method, notes)
  VALUES (p_aircraft, GREATEST(p_gal,0), p_method, p_notes);
END;
$function$
;

create policy "owner can select their aircraft"
on "public"."aircraft"
as permissive
for select
to public
using ((owner_id = auth.uid()));


create policy "owners can insert their aircraft"
on "public"."aircraft"
as permissive
for insert
to public
with check ((owner_id = auth.uid()));


create policy "aircraft_consumables_owner_all"
on "public"."aircraft_consumables"
as permissive
for all
to public
using ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = aircraft_consumables.aircraft_id) AND (a.owner_id = auth.uid())))))
with check ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = aircraft_consumables.aircraft_id) AND (a.owner_id = auth.uid())))));


create policy "aircraft_consumables_owner_select"
on "public"."aircraft_consumables"
as permissive
for select
to public
using ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = aircraft_consumables.aircraft_id) AND (a.owner_id = auth.uid())))));


create policy "documents_owner_all"
on "public"."documents"
as permissive
for all
to public
using (((owner_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = documents.aircraft_id) AND (a.owner_id = auth.uid()))))))
with check (((owner_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = documents.aircraft_id) AND (a.owner_id = auth.uid()))))));


create policy "documents_owner_select"
on "public"."documents"
as permissive
for select
to public
using (((owner_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = documents.aircraft_id) AND (a.owner_id = auth.uid()))))));


create policy "insurance_policies_owner_all"
on "public"."insurance_policies"
as permissive
for all
to public
using ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = insurance_policies.aircraft_id) AND (a.owner_id = auth.uid())))))
with check ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = insurance_policies.aircraft_id) AND (a.owner_id = auth.uid())))));


create policy "insurance_policies_owner_select"
on "public"."insurance_policies"
as permissive
for select
to public
using ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = insurance_policies.aircraft_id) AND (a.owner_id = auth.uid())))));


create policy "owner can select invoices"
on "public"."invoices"
as permissive
for select
to public
using ((owner_id = auth.uid()));


create policy "maintenance_due_owner_all"
on "public"."maintenance_due"
as permissive
for all
to public
using ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = maintenance_due.aircraft_id) AND (a.owner_id = auth.uid())))))
with check ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = maintenance_due.aircraft_id) AND (a.owner_id = auth.uid())))));


create policy "maintenance_due_owner_select"
on "public"."maintenance_due"
as permissive
for select
to public
using ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = maintenance_due.aircraft_id) AND (a.owner_id = auth.uid())))));


create policy "owner can select memberships"
on "public"."memberships"
as permissive
for select
to public
using ((owner_id = auth.uid()));


create policy "owners can insert their membership"
on "public"."memberships"
as permissive
for insert
to public
with check ((owner_id = auth.uid()));


create policy "notifications_owner_all"
on "public"."notifications"
as permissive
for all
to public
using ((user_id = auth.uid()))
with check ((user_id = auth.uid()));


create policy "notifications_owner_select"
on "public"."notifications"
as permissive
for select
to public
using ((user_id = auth.uid()));


create policy "payment_methods_owner_all"
on "public"."payment_methods"
as permissive
for all
to public
using ((owner_id = auth.uid()))
with check ((owner_id = auth.uid()));


create policy "payment_methods_owner_select"
on "public"."payment_methods"
as permissive
for select
to public
using ((owner_id = auth.uid()));


create policy "pilot_currency_owner_all"
on "public"."pilot_currency"
as permissive
for all
to public
using ((owner_id = auth.uid()))
with check ((owner_id = auth.uid()));


create policy "pilot_currency_owner_select"
on "public"."pilot_currency"
as permissive
for select
to public
using ((owner_id = auth.uid()));


create policy "reservations_owner_delete"
on "public"."reservations"
as permissive
for delete
to public
using (((owner_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = reservations.aircraft_id) AND (a.owner_id = auth.uid()))))));


create policy "reservations_owner_insert"
on "public"."reservations"
as permissive
for insert
to public
with check (((owner_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = reservations.aircraft_id) AND (a.owner_id = auth.uid()))))));


create policy "reservations_owner_select"
on "public"."reservations"
as permissive
for select
to public
using (((owner_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = reservations.aircraft_id) AND (a.owner_id = auth.uid()))))));


create policy "reservations_owner_update"
on "public"."reservations"
as permissive
for update
to public
using (((owner_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = reservations.aircraft_id) AND (a.owner_id = auth.uid()))))));


create policy "owner can select their requests"
on "public"."service_requests"
as permissive
for select
to public
using ((user_id = auth.uid()));


create policy "owner_select_service_requests"
on "public"."service_requests"
as permissive
for select
to public
using (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_roles ur
  WHERE ((ur.user_id = auth.uid()) AND (ur.role = 'admin'::app_role))))));


create policy "user can insert their own requests"
on "public"."service_requests"
as permissive
for insert
to public
with check ((user_id = auth.uid()));


create policy "owner sees tasks for their aircraft"
on "public"."service_tasks"
as permissive
for select
to public
using ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = service_tasks.aircraft_id) AND (a.owner_id = auth.uid())))));


create policy "owners can insert tasks for their aircraft"
on "public"."service_tasks"
as permissive
for insert
to public
with check ((EXISTS ( SELECT 1
   FROM aircraft a
  WHERE ((a.id = service_tasks.aircraft_id) AND (a.owner_id = auth.uid())))));


create policy "support_tickets_owner_all"
on "public"."support_tickets"
as permissive
for all
to public
using ((owner_id = auth.uid()))
with check ((owner_id = auth.uid()));


create policy "support_tickets_owner_select"
on "public"."support_tickets"
as permissive
for select
to public
using ((owner_id = auth.uid()));


CREATE TRIGGER trg_updated_at_aircraft BEFORE UPDATE ON public.aircraft FOR EACH ROW EXECUTE FUNCTION set_updated_at();

CREATE TRIGGER aircraft_consumables_set_updated_at BEFORE UPDATE ON public.aircraft_consumables FOR EACH ROW EXECUTE FUNCTION tg_set_updated_at();

CREATE TRIGGER documents_set_updated_at BEFORE UPDATE ON public.documents FOR EACH ROW EXECUTE FUNCTION tg_set_updated_at();

CREATE TRIGGER insurance_policies_set_updated_at BEFORE UPDATE ON public.insurance_policies FOR EACH ROW EXECUTE FUNCTION tg_set_updated_at();

CREATE TRIGGER maintenance_due_set_updated_at BEFORE UPDATE ON public.maintenance_due FOR EACH ROW EXECUTE FUNCTION tg_set_updated_at();

CREATE TRIGGER payment_methods_set_updated_at BEFORE UPDATE ON public.payment_methods FOR EACH ROW EXECUTE FUNCTION tg_set_updated_at();

CREATE TRIGGER pilot_currency_set_updated_at BEFORE UPDATE ON public.pilot_currency FOR EACH ROW EXECUTE FUNCTION tg_set_updated_at();

CREATE TRIGGER reservations_set_updated_at BEFORE UPDATE ON public.reservations FOR EACH ROW EXECUTE FUNCTION tg_set_updated_at();

CREATE TRIGGER trg_updated_at_service_requests BEFORE UPDATE ON public.service_requests FOR EACH ROW EXECUTE FUNCTION set_updated_at();

CREATE TRIGGER support_tickets_set_updated_at BEFORE UPDATE ON public.support_tickets FOR EACH ROW EXECUTE FUNCTION tg_set_updated_at();



